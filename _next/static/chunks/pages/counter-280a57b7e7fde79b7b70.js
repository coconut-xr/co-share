(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{4929:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return A}});var n=t(7378),s=t(5671),o=t(3144),c=t(7326),p=t(9340),r=t(6215),m=t(1120),k=t(4942),N=t(3349),l=t(9148);function u(e){var a=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,m.Z)(e);if(a){var s=(0,m.Z)(this).constructor;t=Reflect.construct(n,arguments,s)}else t=n.apply(this,arguments);return(0,r.Z)(this,t)}}var i=function(e){(0,p.Z)(t,e);var a=u(t);function t(e){var n;return(0,s.Z)(this,t),n=a.call(this),(0,k.Z)((0,c.Z)(n),"subscriber",N.Subscriber.create(t,(function(e,a,t){return a(n.state.getState().counter)}))),(0,k.Z)((0,c.Z)(n),"state",void 0),(0,k.Z)((0,c.Z)(n),"increase",N.Action.create((0,c.Z)(n),"incr",(function(e){n.increase.publishTo(null==e?{to:"all"}:{to:"all-except-one",except:e}),n.state.setState({counter:n.state.getState().counter+1})}))),n.state=(0,l.Z)((function(){return{counter:e}})),n}return(0,o.Z)(t,[{key:"onUnlink",value:function(e){}},{key:"onLink",value:function(e){}}]),t}(N.Store),d=t(4671),h=t(8077),y=t(4467),b=t(1655),g=t(7462),f=t(4925),w=t(3905),S=["components"],v={};function C(e){var a=e.components,t=(0,f.Z)(e,S);return(0,w.kt)("wrapper",(0,g.Z)({},v,t,{components:a,mdxType:"MDXLayout"}),(0,w.kt)("h1",null,"Tutorial: Counter"),(0,w.kt)("p",null,"Welcome to the ",(0,w.kt)("inlineCode",{parentName:"p"},"co-share")," Tutorial, where we will build a shared counter and display it using ",(0,w.kt)("inlineCode",{parentName:"p"},"react"),".\nAbove, you can see a local simulation, but this library is meant for ",(0,w.kt)("strong",{parentName:"p"},"networked communication")," using WebSocket or WebRTC."),(0,w.kt)("hr",null),(0,w.kt)("h2",null,"Store"),(0,w.kt)("p",null,"Let's begin by writing the ",(0,w.kt)("strong",{parentName:"p"},"Store"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"CounterStore"))," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"extends")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Store")),"\n")),(0,w.kt)("p",null,"We create the class ",(0,w.kt)("inlineCode",{parentName:"p"},"CounterStore")," and extend it from the ",(0,w.kt)("strong",{parentName:"p"},"Store"),"-class.",(0,w.kt)("br",{parentName:"p"}),"\n","As the counter must persist in a state, we will use ",(0,w.kt)("inlineCode",{parentName:"p"},"zustand/vanilla")," to persist the current number.\nTherefore we add the attribute state to the ",(0,w.kt)("inlineCode",{parentName:"p"},"CounterStore"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," state",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreApi"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n")),(0,w.kt)("p",null,"This state has to be initialized, so let's do that inside the constructor."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"   ",(0,w.kt)("span",{parentName:"code",className:"token function"},"constructor"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"super"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," value ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,w.kt)("p",null,"We expect to receive the current ",(0,w.kt)("inlineCode",{parentName:"p"},"value")," when creating a store.\nThe ",(0,w.kt)("inlineCode",{parentName:"p"},"value")," needs to come from an existing store, which we want to subscribe to.\nThis logic is inside the ",(0,w.kt)("inlineCode",{parentName:"p"},"subscriber")," attribute, which all ",(0,w.kt)("strong",{parentName:"p"},"Stores")," have implemented.\nSo let's create such a ",(0,w.kt)("strong",{parentName:"p"},"Subscriber")," ..."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"CounterStore"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"connection",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," accept",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," deny",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"accept"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"counter"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"... and assign it to the ",(0,w.kt)("inlineCode",{parentName:"p"},"CounterStore"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," subscriber",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"CounterStore"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token spread operator"},"..."),"\n")),(0,w.kt)("p",null,"The function passed to the ",(0,w.kt)("strong",{parentName:"p"},"Subscriber")," creation is called when a store wants to subscribe to this ",(0,w.kt)("strong",{parentName:"p"},"Store"),".\nThe function decides whether the subscription is accepted or denied by using the respective callbacks.\nWhen accepting a subscription, the Store has to pass the values required to recreate the Store on the subscriber side."),(0,w.kt)("p",null,"That's it. Now the stores are synchronized.\nBut they do not change ..."),(0,w.kt)("p",null,"We implement an ",(0,w.kt)("strong",{parentName:"p"},"Action")," to change the counter, which is the same concept as a ",(0,w.kt)("em",{parentName:"p"},"Remote Method Invocation"),".\n",(0,w.kt)("strong",{parentName:"p"},"Actions")," can be executed locally and published to a remote store.\n",(0,w.kt)("strong",{parentName:"p"},"Actions")," can have parameters, which are the same for local and remote execution."),(0,w.kt)("p",null,"We will create an ",(0,w.kt)("inlineCode",{parentName:"p"},"increase")," function with no parameters."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"increase ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"incr"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n")),(0,w.kt)("p",null,"The public ",(0,w.kt)("strong",{parentName:"p"},"Action")," identifier will be ",(0,w.kt)("inlineCode",{parentName:"p"},"incr"),". The ",(0,w.kt)("inlineCode",{parentName:"p"},"origin")," is a link to the Store that has issued this invocation."),(0,w.kt)("p",null,"The increase function should simply add 1 to the current counter value."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"setState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"counter")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"+")," ",(0,w.kt)("span",{parentName:"code",className:"token number"},"1"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"Now the counter is changed, but only locally. We have not yet published this ",(0,w.kt)("strong",{parentName:"p"},"Action")," to any other store."),(0,w.kt)("p",null,"This is done by calling ",(0,w.kt)("inlineCode",{parentName:"p"},"publishTo")," on the ",(0,w.kt)("strong",{parentName:"p"},"Action"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"increase"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"If the ",(0,w.kt)("inlineCode",{parentName:"p"},"origin")," is null, the ",(0,w.kt)("strong",{parentName:"p"},"Action")," was invoked locally, and thus no origin is present.",(0,w.kt)("br",{parentName:"p"}),"\n","The ",(0,w.kt)("inlineCode",{parentName:"p"},"increase")," ",(0,w.kt)("strong",{parentName:"p"},"Action")," is now an attribute of the ",(0,w.kt)("inlineCode",{parentName:"p"},"CounterStore"),", which will look like this."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"increase ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"incr"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"increase"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"setState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"counter")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"+")," ",(0,w.kt)("span",{parentName:"code",className:"token number"},"1"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"Lastly, we need to implement some abstract methods which we can leave empty but are interesting callbacks."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"onUnlink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"onLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,w.kt)("p",null,(0,w.kt)("inlineCode",{parentName:"p"},"onUnlink")," and ",(0,w.kt)("inlineCode",{parentName:"p"},"onLink")," are invoked when a link to this Store is established or destroyed.\nHowever, for the simple counter, these two functions can be left empty."),(0,w.kt)("p",null,"Now we are done with the Store. The complete code looks like this (",(0,w.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/stores/counter.ts"},(0,w.kt)("inlineCode",{parentName:"a"},"counter.ts")),")."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"CounterStore"))," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"extends")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Store"))," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," subscriber",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"CounterStore"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"CounterStore"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"connection",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," accept",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," deny",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"accept"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"counter"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," state",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreApi"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"onUnlink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"onLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token function"},"constructor"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"super"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," value ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    increase ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"incr"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"increase"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"setState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            counter",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"counter")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"+")," ",(0,w.kt)("span",{parentName:"code",className:"token number"},"1"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,w.kt)("hr",null),(0,w.kt)("h2",null,"View and Interaction"),(0,w.kt)("p",null,"Let's move on and show see how we can interact and show the Store."),(0,w.kt)("p",null,"We will use react to show the current value and invoke the ",(0,w.kt)("inlineCode",{parentName:"p"},"increase")," ",(0,w.kt)("strong",{parentName:"p"},"Action")," via a button."),(0,w.kt)("p",null,"We assume you are a little familiar with ",(0,w.kt)("inlineCode",{parentName:"p"},"react"),"."),(0,w.kt)("p",null,"The only ",(0,w.kt)("inlineCode",{parentName:"p"},"react")," specific code ",(0,w.kt)("inlineCode",{parentName:"p"},"co-share")," offers is the ",(0,w.kt)("inlineCode",{parentName:"p"},"useStoreSubscription")," hook.",(0,w.kt)("br",{parentName:"p"}),"\n","This hook allows you to specify the path to the ",(0,w.kt)("strong",{parentName:"p"},"Store")," you want to subscribe to, the time to wait after retrying the subscription when something fails, and how to create the requested Store from the returned parameters."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," store ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useStoreSubscription"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token string"},'"counter"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"CounterStore")),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"We can now access the Store inside the react code freely.\nSo let's use the state from ",(0,w.kt)("inlineCode",{parentName:"p"},"zustand"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," useStoreState ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useMemo"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token generic-function"},(0,w.kt)("span",{parentName:"span",className:"token function"},"create"),(0,w.kt)("span",{parentName:"span",className:"token generic class-name"},(0,w.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"span",className:"token punctuation"},"{"),"\n            counter",(0,w.kt)("span",{parentName:"span",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"span",className:"token builtin"},"number"),"\n        ",(0,w.kt)("span",{parentName:"span",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"span",className:"token operator"},">"))),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"["),"store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"]"),"\n",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"Since we had to use ",(0,w.kt)("inlineCode",{parentName:"p"},"zustand/vanilla")," in the Store to be executable on NodeJS, we now have to turn the ",(0,w.kt)("inlineCode",{parentName:"p"},"StoreAPI")," into a hook using the ",(0,w.kt)("inlineCode",{parentName:"p"},"create")," function.",(0,w.kt)("br",{parentName:"p"}),"\n","We memorize this value, so it's not recreated too often."),(0,w.kt)("p",null,"Now we have retrieved our ",(0,w.kt)("inlineCode",{parentName:"p"},"useStoreState")," hook and can retrieve the ",(0,w.kt)("inlineCode",{parentName:"p"},"counter")," from it."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useStoreState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n")),(0,w.kt)("p",null,"The ",(0,w.kt)("inlineCode",{parentName:"p"},"counter")," value will now be updated every time the counter changes, resulting in a rerender of the component."),(0,w.kt)("p",null,"The last step is to render this value ..."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"    ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"div className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"p-3 d-flex flex-row align-items-center"'),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"h1 className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"mx-3"'),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"counter",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"h1",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n")),(0,w.kt)("p",null,"... and add a button to increase the counter.\nSince we have access to the Store, we can directly call the ",(0,w.kt)("inlineCode",{parentName:"p"},"increase")," ",(0,w.kt)("strong",{parentName:"p"},"Action"),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},"        ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"button className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"m-1 btn btn-outline-primary"')," onClick",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"increase"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"+"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"button",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"div",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n")),(0,w.kt)("p",null,"That's it, now the Store can be shared and changed from multiple clients, and the changes are reflected on the screen."),(0,w.kt)("p",null,"The complete code for the ",(0,w.kt)("inlineCode",{parentName:"p"},"react")," page is below or at ",(0,w.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/pages/counter.tsx"},(0,w.kt)("inlineCode",{parentName:"a"},"counter.tsx")),"."),(0,w.kt)("pre",{className:"language-typescript"},(0,w.kt)("code",{parentName:"pre",className:"language-typescript"},(0,w.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"CounterExamplePage")),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," store ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useStoreSubscription"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token string"},'"counter"'),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,w.kt)("span",{parentName:"code",className:"token class-name"},(0,w.kt)("span",{parentName:"span",className:"token maybe-class-name"},"CounterStore")),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," useStoreState ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useMemo"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>"),"\n            ",(0,w.kt)("span",{parentName:"code",className:"token generic-function"},(0,w.kt)("span",{parentName:"span",className:"token function"},"create"),(0,w.kt)("span",{parentName:"span",className:"token generic class-name"},(0,w.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"span",className:"token punctuation"},"{"),"\n                counter",(0,w.kt)("span",{parentName:"span",className:"token operator"},":")," ",(0,w.kt)("span",{parentName:"span",className:"token builtin"},"number"),"\n            ",(0,w.kt)("span",{parentName:"span",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"span",className:"token operator"},">"))),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"["),"store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"]"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{")," counter ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,w.kt)("span",{parentName:"code",className:"token function"},"useStoreState"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,w.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"div className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"p-3 d-flex flex-row align-items-center"'),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"h1 className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"mx-3"'),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"counter",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"h1",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),"button className",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token string"},'"m-1 btn btn-outline-primary"')," onClick",(0,w.kt)("span",{parentName:"code",className:"token operator"},"="),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,w.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," store",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,w.kt)("span",{parentName:"code",className:"token method function property-access"},"increase"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"+"),"\n            ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"button",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n        ",(0,w.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,w.kt)("span",{parentName:"code",className:"token operator"},"/"),"div",(0,w.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,w.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,w.kt)("h2",null,"What's Next?"),(0,w.kt)("blockquote",null,(0,w.kt)("p",{parentName:"blockquote"},"That was easy. Can you show me something ",(0,w.kt)("strong",{parentName:"p"},"more complex"),"?")),(0,w.kt)("p",null,"Check out the other ",(0,w.kt)("a",{parentName:"p",href:"https://cocoss-org.github.io/co-share"},(0,w.kt)("strong",{parentName:"a"},"Examples")),". They increase in complexity."),(0,w.kt)("blockquote",null,(0,w.kt)("p",{parentName:"blockquote"},"Have something to ",(0,w.kt)("strong",{parentName:"p"},"complain")," about or correct?")),(0,w.kt)("p",null,(0,w.kt)("strong",{parentName:"p"},"write an issue or a PR")),(0,w.kt)("blockquote",null,(0,w.kt)("p",{parentName:"blockquote"},"Want to see the complete code for a ",(0,w.kt)("em",{parentName:"p"},"real")," ",(0,w.kt)("strong",{parentName:"p"},"networked")," version of the counter using ",(0,w.kt)("inlineCode",{parentName:"p"},"socketio"),"?")),(0,w.kt)("p",null,"Check out the ",(0,w.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share-socketio-counter-example"},"co-share-socketio-counter-example")),(0,w.kt)("blockquote",null,(0,w.kt)("p",{parentName:"blockquote"},"Motivated to build an MMORPG / Multiplayer First Person Shooter / ... ?")),(0,w.kt)("p",null,"Well, ",(0,w.kt)("strong",{parentName:"p"},"go for it"),"! We recommend to use ",(0,w.kt)("inlineCode",{parentName:"p"},"co-share"),", ",(0,w.kt)("inlineCode",{parentName:"p"},"co-share-socketio"),", ",(0,w.kt)("inlineCode",{parentName:"p"},"react")," and ",(0,w.kt)("inlineCode",{parentName:"p"},"react-three-fiber"),"."))}C.isMDXComponent=!0;var x=t(9138),T=t(4246);function A(){return(0,T.jsxs)("div",{className:"d-flex flex-column fullscreen",children:[(0,T.jsx)(b.h,{selectedIndex:0}),(0,T.jsxs)("div",{className:"d-flex flex-column justify-content-stretch container-lg",children:[(0,T.jsx)("div",{className:"d-flex flex-row-responsive",children:(0,T.jsx)(y.X,{twoClients:!0,initStores:function(e){return e.addStore(new i(0),"counter")},children:function(e){return(0,T.jsx)(j,{rootStore:e})}})}),(0,T.jsx)("div",{className:"p-3 flex-basis-0 flex-grow-1",children:(0,T.jsx)(C,{})})]}),(0,T.jsx)(x.$,{})]})}function j(e){var a=e.rootStore,t=(0,h.useStoreSubscription)("counter",1e3,(function(e){return new i(e)}),void 0,a),s=(0,n.useMemo)((function(){return(0,d.Z)(t.state)}),[t])().counter;return(0,T.jsxs)("div",{className:"p-3 d-flex flex-row align-items-center",children:[(0,T.jsx)("h1",{className:"mx-3",children:s}),(0,T.jsx)("button",{className:"m-1 btn btn-outline-primary",onClick:function(){return t.increase()},children:"+"})]})}},7017:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/counter",function(){return t(4929)}])},4671:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var n=t(7378);function s(e){let a;const t=new Set,n=(e,n)=>{const s="function"===typeof e?e(a):e;if(s!==a){const e=a;a=n?s:Object.assign({},a,s),t.forEach((t=>t(a,e)))}},s=()=>a,o={setState:n,getState:s,subscribe:(e,n,o)=>n||o?((e,n=s,o=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let c=n(a);function p(){const t=n(a);if(!o(c,t)){const a=c;e(c=t,a)}}return t.add(p),()=>t.delete(p)})(e,n,o):(t.add(e),()=>t.delete(e)),destroy:()=>t.clear()};return a=e(n,s,o),o}const o="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?n.useEffect:n.useLayoutEffect;function c(e){const a="function"===typeof e?s(e):e,t=(e=a.getState,t=Object.is)=>{const[,s]=(0,n.useReducer)((e=>e+1),0),c=a.getState(),p=(0,n.useRef)(c),r=(0,n.useRef)(e),m=(0,n.useRef)(t),k=(0,n.useRef)(!1),N=(0,n.useRef)();let l;void 0===N.current&&(N.current=e(c));let u=!1;(p.current!==c||r.current!==e||m.current!==t||k.current)&&(l=e(c),u=!t(N.current,l)),o((()=>{u&&(N.current=l),p.current=c,r.current=e,m.current=t,k.current=!1}));const i=(0,n.useRef)(c);o((()=>{const e=()=>{try{const e=a.getState(),t=r.current(e);m.current(N.current,t)||(p.current=e,N.current=t,s())}catch(e){k.current=!0,s()}},t=a.subscribe(e);return a.getState()!==i.current&&e(),t}),[]);const d=u?l:N.current;return(0,n.useDebugValue)(d),d};return Object.assign(t,a),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[t,a];return{next(){const a=e.length<=0;return{value:e.shift(),done:a}}}},t}},9148:function(e,a,t){"use strict";function n(e){let a;const t=new Set,n=(e,n)=>{const s="function"===typeof e?e(a):e;if(s!==a){const e=a;a=n?s:Object.assign({},a,s),t.forEach((t=>t(a,e)))}},s=()=>a,o={setState:n,getState:s,subscribe:(e,n,o)=>n||o?((e,n=s,o=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let c=n(a);function p(){const t=n(a);if(!o(c,t)){const a=c;e(c=t,a)}}return t.add(p),()=>t.delete(p)})(e,n,o):(t.add(e),()=>t.delete(e)),destroy:()=>t.clear()};return a=e(n,s,o),o}t.d(a,{Z:function(){return n}})}},function(e){e.O(0,[667,377,100,774,888,179],(function(){return a=7017,e(e.s=a);var a}));var a=e.O();_N_E=a}]);
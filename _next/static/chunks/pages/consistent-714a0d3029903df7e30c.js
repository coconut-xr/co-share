(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[954],{5733:function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Clock=void 0;var t=function(){function e(e,a,t){void 0===t&&(t=1),this.stateTime=e,this.getRealTime=a,this.stateTimeVelocity=t,this.changePeriodRealTime=0,this.changePerRealTime=0,this.waitSet=new Set,this.realTimeAtStateTime=this.getRealTime()}return e.prototype.getRealTimePassed=function(e){return e-this.realTimeAtStateTime},e.prototype.getPassedChangePeriod=function(e){return Math.min(this.changePeriodRealTime,e)},e.prototype.computeStateTime=function(e,a){return this.stateTime+e*this.stateTimeVelocity+a*this.changePerRealTime},e.prototype.beforeChange=function(e){var a=this,t=this.getPassedChangePeriod(e);this.stateTime=this.computeStateTime(e,t),this.waitSet.forEach((function(e){e.waitTime-=a.stateTime-e.startTime,e.startTime=a.stateTime})),this.changePeriodRealTime-=t,this.realTimeAtStateTime+=e},e.prototype.afterChange=function(){var e=this;this.waitSet.forEach((function(a){clearTimeout(a.timeoutRef),a.timeoutRef=e.createWaitTimeout(a.callback,a.waitTime)}))},e.prototype.createWaitTimeout=function(e,a){return setTimeout(e,Math.max(0,Math.ceil(this.calculateRealTimeLeftTo(a))))},e.prototype.calculateRealTimeLeftTo=function(e){var a,t=this.stateTimeVelocity+this.changePerRealTime,n=t*this.changePeriodRealTime;if(e>n){var s=e-n;a=this.changePeriodRealTime+s/this.stateTimeVelocity}else a=e/t;return a},e.prototype.change=function(e,a){if(void 0===a&&(a=.1),a>1&&e<0)throw new Error("changeRate should no be over 1 when the offset is negative. We can't go backwards in time.");var t=this.getRealTimePassed(this.getRealTime());this.beforeChange(t),this.changePerRealTime=e<0?-Math.abs(a):Math.abs(a),this.changePeriodRealTime=e/this.changePerRealTime,this.afterChange()},e.prototype.wait=function(e){var a=this;return new Promise((function(t){var n=a.getRealTimePassed(a.getRealTime());a.beforeChange(n);var s=function(){a.waitSet.delete(o),t()},o={timeoutRef:a.createWaitTimeout(s,e),callback:s,waitTime:e,startTime:a.computeCurrentTime(n)};a.waitSet.add(o)}))},e.prototype.computeCurrentTime=function(e){return this.computeStateTime(e,this.getPassedChangePeriod(e))},e.prototype.getCurrentTime=function(){return this.computeCurrentTime(this.getRealTimePassed(this.getRealTime()))},e.prototype.jump=function(e){if(e<0)throw"can't jump backwards in state time";var a=this.getRealTimePassed(this.getRealTime());this.stateTime+=e,this.beforeChange(a),this.afterChange()},e.prototype.setVelocity=function(e){if(e<0)throw new Error("velocity can't be negative");var a=this.getRealTimePassed(this.getRealTime());this.beforeChange(a),this.stateTimeVelocity=e,this.afterChange()},e.prototype.getVelocity=function(){return this.stateTimeVelocity},e.prototype.destroy=function(){this.waitSet.forEach((function(e){clearTimeout(e.timeoutRef)}))},e}();a.Clock=t},2222:function(e,a,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,a,t,n){void 0===n&&(n=t),Object.defineProperty(e,n,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,n){void 0===n&&(n=t),e[n]=a[t]}),s=this&&this.__exportStar||function(e,a){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(a,t)||n(a,e,t)};Object.defineProperty(a,"__esModule",{value:!0}),s(t(5733),a),s(t(3839),a),s(t(5484),a)},3839:function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0})},5484:function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Universe=void 0;var t=function(){function e(e,a,t,n){this.createStore=e,this.compareAction=a,this.historyDuration=t,this.onChange=n,this.history=[],this.baseHelper1=e(),this.baseHelper2=e()}return e.prototype.removeOldElements=function(e){for(var a=0;a<this.history.length-1&&e-this.history[a+1].time>this.historyDuration;)a++;this.history.splice(0,a)},e.prototype.insert=function(e,a,t,n){var s;if(this.removeOldElements(a),null==t)t=a;else if(t>a)throw"time (".concat(t,") can't be bigger then current time (").concat(a,") (maybe jump the clock forwards?)");var o,c=this.findEntryIndexBefore(t,e);if(-1===c)return!1;var p=0;if(-2===c){if(null==n)throw"unable to insert action at time: ".concat(t," (too old)");c=-1}else{var r=this.history[c];o=r.result,p=t-r.time}return null==n&&(n=this.createStore()).update(o,p,e,void 0,void 0),this.history.splice(c+1,0,{action:e,time:t,result:n,deltaTime:p}),this.recalculateAfter(c+1,null===(s=this.history[c])||void 0===s?void 0:s.result),!0},e.prototype.recalculateAfter=function(e,a){if(e<this.history.length-1){var t=this.history[e],n=this.history[e+1],s=n.time-t.time,o=this.baseHelper1===a?this.baseHelper2:this.baseHelper1;o.copyFrom(n.result),n.result.update(t.result,s,n.action,n.deltaTime,a),this.recalculateAfter(e+1,o)}else this.onChange&&this.onChange()},e.prototype.findEntryIndexBefore=function(e,a){for(var t=this.history.length-1;t>=0;t--){var n=this.history[t];if(n.time<=e){if(n.time===e&&null!=a){var s=this.compareAction(n.action,a);if(s>0)continue;if(0===s)return-1}return t}}return-2},e.prototype.applyStateAt=function(e,a,t){if(t<a.time)throw"can't extrapolate state into the past";e.update(a.result,t-a.time,void 0,void 0,void 0)},e.prototype.applyCurrentState=function(e,a){this.applyStateAt(e,this.history[this.history.length-1],a)},e}();a.Universe=t},1568:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return Z}});var n=t(7378),s=t(8077),o=t(4467),c=t(1655),p=t(7462),r=t(4925),m=t(3905),k=["components"],N={};function l(e){var a=e.components,t=(0,r.Z)(e,k);return(0,m.kt)("wrapper",(0,p.Z)({},N,t,{components:a,mdxType:"MDXLayout"}),(0,m.kt)("h1",null,"Consistent Example"),(0,m.kt)("p",null,"We synchronize a ball that bounces off walls. All clients can invert the direction.",(0,m.kt)("br",{parentName:"p"}),"\n","This example is tricky because you can not lock the ball to one player.",(0,m.kt)("br",{parentName:"p"}),"\n","The simplest solution would let the server execute the inversion and confirm it to the client. However, this is slow, and we want ",(0,m.kt)("strong",{parentName:"p"},"client-side prediction")," and ",(0,m.kt)("strong",{parentName:"p"},"lag-compensation"),".",(0,m.kt)("br",{parentName:"p"}),"\n","We use the library ",(0,m.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-consistent"},"co-consistent")," and its concept of ",(0,m.kt)("em",{parentName:"p"},"extrapolatable states")," to assure consistent behaviour at all participants.",(0,m.kt)("br",{parentName:"p"}),"\n","After calculating a consistent state on all clients, we applied a ",(0,m.kt)("strong",{parentName:"p"},"smoothing layer")," to have a good UX even when lagging. Our example provides a button to disable this smoothing at each client."),(0,m.kt)("p",null,"You can test the correctness even when changing or randomizing the simulated ",(0,m.kt)("strong",{parentName:"p"},"latency"),"."),(0,m.kt)("h1",null,"Source Code"),(0,m.kt)("p",null,(0,m.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/stores/consistent.ts"},(0,m.kt)("inlineCode",{parentName:"a"},"consistent.ts"))),(0,m.kt)("pre",{className:"language-typescript"},(0,m.kt)("code",{parentName:"pre",className:"language-typescript"},(0,m.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ConsistentStore"))," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"extends")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Store"))," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    subscriber",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Store"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),"time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"ConsistentStore"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"connection",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," accept",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," time ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," entry ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"length")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"applyStateAt"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," entry",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token function"},"accept"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"private")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"readonly")," universe",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Universe"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"ContinousState"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"readonly")," clock",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Clock"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"readonly")," smoothedRef",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," state",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"SmoothState")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},";")," time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        state",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"private")," realStateRef ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ContinousState")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token number"},"0"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token boolean"},"false"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"constructor"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"private")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"readonly")," onServer",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"super"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Clock")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," global",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"window")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"0")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token dom variable"},"window"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"performance"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"now"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Universe")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ContinousState")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token number"},"0"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token boolean"},"false"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"a1",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," a2",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," a1",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"id")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," a2",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"id"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token number"},"2000"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token operator"},"!"),"onServer",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token function"},"setTimeout"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"informTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"insert"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                id",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"random"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n                type",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"init"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ContinousState")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    changeTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"changeTime"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," by",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"onServer"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"throw")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token known-class-name class-name"},"Error")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token string"},'"should not warp time on the server"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"change"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"by",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"0.5"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"wait"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"max"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token number"},"500"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," by ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"2"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"then"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"informTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    informTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"informTime"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," currentTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"informTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"one"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," one",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"mainLink")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"else")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"currentTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"!=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"&&")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"onServer"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"changeTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"one"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," one",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," currentTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    invert ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"invert"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"async")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," stateTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," id",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"let")," currentTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token comment"},"//local"),"\n            id ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"random"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            stateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," currentTime\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"else")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"stateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"||")," id ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"stateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},">")," currentTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," jumpBy ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," stateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," currentTime\n                ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"onServer"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"await")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"wait"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"jumpBy",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"else")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"jump"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"jumpBy",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n                currentTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"!=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"&&")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"!=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," deltaTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," currentTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"+=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," deltaTime\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-"),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," currentTime\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"insert"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                type",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"invert"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n                id",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            currentTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            stateTime\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"invert"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," stateTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," id",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"getCurrentValue"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"smoothed",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," realStateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," entry ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"length")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"universe"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"applyStateAt"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," entry",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," realStateTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"let")," value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"||")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n                velocity",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-"),"velocity ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," velocity",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            value ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"else")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token function"},"applySmoothing"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," realStateTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            value ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," smoothed ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"realStateRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"smoothedRef"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"time")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," realStateTime\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," abs ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"abs"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," backwards ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"floor"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"abs",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"%")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"2")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"===")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," backwards ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"abs ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"%")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," abs ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"%")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"onUnlink"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"onLink"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," velocity ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"0.0001"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"type")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"StateAction"))," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    type",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"init"')," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"invert"'),"\n    id",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"type")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"SmoothState"))," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),"\n    velocity",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ContinousState"))," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"implements")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"State"),(0,m.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"StateAction"),(0,m.kt)("span",{parentName:"span",className:"token operator"},">"))," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"constructor"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token keyword"},"public")," value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"public")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"update"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        base",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        deltaTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        action",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StateAction")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        prevDeltaTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        prevBase",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"|")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"action",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?."),"type ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"===")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"init"')," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"||")," base ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n            action",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?."),"type ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"invert"')," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"&&"),"\n            base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"===")," prevBase",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?."),"directionInverted ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"&&"),"\n            base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"===")," prevBase",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?."),"value ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"&&"),"\n            prevDeltaTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"===")," deltaTime\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"+")," deltaTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-"),"velocity ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," velocity",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," action ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"!"),"base",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"copyFrom"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"ref",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ref",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ref",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"applySmoothing"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n    smoothState",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"SmoothState"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    smoothStateTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    realState",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"ContinousState"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    realStateTime",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," deltaTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," realStateTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," smoothStateTime\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," velocityReal ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," realState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"directionInverted")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-"),"velocity ",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," velocity\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," valueReal ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," realState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," valueSmoothed ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," smoothState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," vd ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"velocityReal ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"+")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token number"},"0.05")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"valueReal ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," valueSmoothed",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/")," deltaTime",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1.05"),"\n    smoothState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"+=")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"limitAbs"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"vd ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"-")," smoothState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," velocity ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," deltaTime ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"0.1"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    smoothState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"value")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"+=")," smoothState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"velocity")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"*")," deltaTime\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"limitAbs"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," limit",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"max"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token operator"},"-"),"limit",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Math"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"min"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"limit",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," value",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,m.kt)("p",null,(0,m.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/pages/consistent.tsx"},(0,m.kt)("inlineCode",{parentName:"a"},"consistent.tsx"))),(0,m.kt)("pre",{className:"language-typescript"},(0,m.kt)("code",{parentName:"pre",className:"language-typescript"},(0,m.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ConsistentExamplePage")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," rootStore ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," rootStore",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"RootStore")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," store ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"useStoreSubscription"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"consistent"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,m.kt)("span",{parentName:"code",className:"token class-name"},(0,m.kt)("span",{parentName:"span",className:"token maybe-class-name"},"ConsistentStore")),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token boolean"},"false"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," value",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," directionInverted",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        rootStore\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),"smoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," setSmoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"useState"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token boolean"},"true"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," marginLeft",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," time ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," setState",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"useState"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        marginLeft",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"calculateMargin"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentValue"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"smoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token function"},"useEffect"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"const")," ref ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,m.kt)("span",{parentName:"code",className:"token dom variable"},"window"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"setInterval"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token function"},"setState"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"clock"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentTime"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n                marginLeft",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"calculateMargin"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"getCurrentValue"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"smoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token number"},"30"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token dom variable"},"window"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"clearInterval"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"ref",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"["),"store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," smoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"div className",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"d-flex flex-column m-3"'),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"div style",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," border",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"1px solid"')," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"span",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"time",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"time",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"toFixed"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token number"},"0"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"span",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"div style",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{")," width",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"3rem"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," height",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"3rem"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," marginLeft",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," background",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"#f00"'),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},",")," borderRadius",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token string"},'"100%"')," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"div",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"button className",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"align-self-start mt-2 btn btn-outline-primary"')," onClick",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," store",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token method function property-access"},"invert"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                invert\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"button",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"div className",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"d-flex flex-row mt-2"'),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"input\n                    checked",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"smoothing",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n                    onChange",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"e",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,m.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"setSmoothing"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"e",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"target"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"code",className:"token property-access"},"checked"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n                    className",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"form-check-input me-2"'),"\n                    type",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"checkbox"'),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n                ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),"label className",(0,m.kt)("span",{parentName:"code",className:"token operator"},"="),(0,m.kt)("span",{parentName:"code",className:"token string"},'"form-check-label"'),(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),(0,m.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Smooting"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"label",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"div",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n        ",(0,m.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,m.kt)("span",{parentName:"code",className:"token operator"},"/"),"div",(0,m.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,m.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,m.kt)("span",{parentName:"code",className:"token function"},"calculateMargin"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"("),"value",(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,m.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,m.kt)("span",{parentName:"code",className:"token builtin"},"string")," ",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,m.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,m.kt)("span",{parentName:"code",className:"token template-string"},(0,m.kt)("span",{parentName:"span",className:"token template-punctuation string"},"`"),(0,m.kt)("span",{parentName:"span",className:"token string"},"calc("),(0,m.kt)("span",{parentName:"span",className:"token interpolation"},(0,m.kt)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"${"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"span",className:"token number"},"100")," ",(0,m.kt)("span",{parentName:"span",className:"token operator"},"*")," value",(0,m.kt)("span",{parentName:"span",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"span",className:"token method function property-access"},"toFixed"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"span",className:"token number"},"3"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"}")),(0,m.kt)("span",{parentName:"span",className:"token string"},"% - "),(0,m.kt)("span",{parentName:"span",className:"token interpolation"},(0,m.kt)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"${"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"span",className:"token number"},"3")," ",(0,m.kt)("span",{parentName:"span",className:"token operator"},"*")," value",(0,m.kt)("span",{parentName:"span",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"."),(0,m.kt)("span",{parentName:"span",className:"token method function property-access"},"toFixed"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},"("),(0,m.kt)("span",{parentName:"span",className:"token number"},"3"),(0,m.kt)("span",{parentName:"span",className:"token punctuation"},")"),(0,m.kt)("span",{parentName:"span",className:"token interpolation-punctuation punctuation"},"}")),(0,m.kt)("span",{parentName:"span",className:"token string"},"rem)"),(0,m.kt)("span",{parentName:"span",className:"token template-punctuation string"},"`")),"\n",(0,m.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")))}l.isMDXComponent=!0;var d=t(9138),u=t(5861),i=t(5671),y=t(3144),h=t(7326),f=t(9340),w=t(6215),v=t(1120),b=t(4942),g=t(7757),T=t.n(g),S=t(2222),R=t(3349);function x(e){var a=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,v.Z)(e);if(a){var s=(0,v.Z)(this).constructor;t=Reflect.construct(n,arguments,s)}else t=n.apply(this,arguments);return(0,w.Z)(this,t)}}var C=function(e){(0,f.Z)(n,e);var a=x(n);function n(e,s,o,c){var p;return(0,i.Z)(this,n),(p=a.call(this)).onServer=e,(0,b.Z)((0,h.Z)(p),"subscriber",R.Subscriber.create(n,(function(e,a){var t=p.clock.getCurrentTime(),n=p.universe.history[p.universe.history.length-1];p.universe.applyStateAt(p.realStateRef,n,t),a(t,p.realStateRef.value,p.realStateRef.directionInverted)}))),(0,b.Z)((0,h.Z)(p),"universe",void 0),(0,b.Z)((0,h.Z)(p),"clock",void 0),(0,b.Z)((0,h.Z)(p),"smoothedRef",{state:void 0,time:void 0}),(0,b.Z)((0,h.Z)(p),"realStateRef",new P(0,!1)),(0,b.Z)((0,h.Z)(p),"changeTime",R.Action.create((0,h.Z)(p),"changeTime",(function(e,a){if(p.onServer)throw new Error("should not warp time on the server");p.clock.change(a,.5),p.clock.wait(Math.max(500,2*a)).then((function(){return p.informTime()}))}))),(0,b.Z)((0,h.Z)(p),"informTime",R.Action.create((0,h.Z)(p),"informTime",(function(e,a){null==e?p.informTime.publishTo({to:"one",one:p.mainLink},p.clock.getCurrentTime()):null!=a&&p.onServer&&p.changeTime.publishTo({to:"one",one:e},p.clock.getCurrentTime()-a)}))),(0,b.Z)((0,h.Z)(p),"invert",R.Action.create((0,h.Z)(p),"invert",function(){var e=(0,u.Z)(T().mark((function e(a,t,n){var s,o,c;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=p.clock.getCurrentTime(),null!=a){e.next=6;break}n=Math.random(),t=s,e.next=17;break;case 6:if(null!=t&&null!=n){e.next=8;break}return e.abrupt("return");case 8:if(!(t>s)){e.next=17;break}if(o=t-s,!p.onServer){e.next=15;break}return e.next=13,p.clock.wait(o);case 13:e.next=16;break;case 15:p.clock.jump(o);case 16:s=p.clock.getCurrentTime();case 17:null!=p.smoothedRef.state&&null!=p.smoothedRef.time&&(c=s-p.smoothedRef.time,p.smoothedRef.state.value+=p.smoothedRef.state.velocity*c,p.smoothedRef.state.velocity=-p.smoothedRef.state.velocity,p.smoothedRef.time=s),p.universe.insert({type:"invert",id:n},s,t),p.invert.publishTo(null==a?{to:"all"}:{to:"all-except-one",except:a},t,n);case 20:case"end":return e.stop()}}),e)})));return function(a,t,n){return e.apply(this,arguments)}}())),p.clock=new S.Clock(s,null==t.g.window?function(){return 0}:function(){return window.performance.now()}),p.universe=new S.Universe((function(){return new P(0,!1)}),(function(e,a){return e.id-a.id}),2e3),e||setTimeout((function(){return p.informTime()})),p.universe.insert({id:Math.random(),type:"init"},s,s,new P(o,c)),p}return(0,y.Z)(n,[{key:"getCurrentValue",value:function(e){var a,t=this.clock.getCurrentTime(),n=this.universe.history[this.universe.history.length-1];this.universe.applyStateAt(this.realStateRef,n,t),null==this.smoothedRef.state||null==this.smoothedRef.time?(this.smoothedRef.state={value:this.realStateRef.value,velocity:this.realStateRef.directionInverted?-I:I},a=this.realStateRef.value):(!function(e,a,t,n){var s=n-a,o=t.directionInverted?-I:I,c=t.value,p=e.value,r=(o+.05*(c-p)/s)/1.05;e.velocity+=function(e,a){return Math.max(-a,Math.min(a,e))}(r-e.velocity,I*s*.1),e.value+=e.velocity*s}(this.smoothedRef.state,this.smoothedRef.time,this.realStateRef,t),a=e?this.smoothedRef.state.value:this.realStateRef.value),this.smoothedRef.time=t;var s=Math.abs(a);return Math.floor(s)%2===1?1-s%1:s%1}},{key:"onUnlink",value:function(e){}},{key:"onLink",value:function(e){}}]),n}(R.Store),I=1e-4,P=function(){function e(a,t){(0,i.Z)(this,e),this.value=a,this.directionInverted=t}return(0,y.Z)(e,[{key:"update",value:function(e,a,t,n,s){"init"!==(null===t||void 0===t?void 0:t.type)&&null!=e&&("invert"==(null===t||void 0===t?void 0:t.type)&&e.directionInverted===(null===s||void 0===s?void 0:s.directionInverted)&&e.value===(null===s||void 0===s?void 0:s.value)&&n===a||(this.value=e.value+a*(e.directionInverted?-I:I),this.directionInverted=null==t?e.directionInverted:!e.directionInverted))}},{key:"copyFrom",value:function(e){this.directionInverted=e.directionInverted,this.value=e.value}}]),e}();var j=t(4246);function Z(){return(0,j.jsxs)("div",{className:"d-flex flex-column fullscreen",children:[(0,j.jsx)(c.h,{selectedIndex:7}),(0,j.jsxs)("div",{className:"d-flex flex-column justify-content-stretch container-lg",children:[(0,j.jsx)("div",{className:"d-flex flex-row-responsive",children:(0,j.jsx)(o.X,{defaultIncommingLatency:500,defaultOutgoingLatency:500,defaultNetworkSettingsCollapsed:!1,twoClients:!0,initStores:function(e){return e.addStore(new C(!0,0,0,!1),"consistent")},children:function(e){return(0,j.jsx)(M,{rootStore:e})}})}),(0,j.jsx)("div",{className:"p-3 flex-basis-0 flex-grow-1",children:(0,j.jsx)(l,{})})]}),(0,j.jsx)(d.$,{})]})}function M(e){var a=e.rootStore,t=(0,s.useStoreSubscription)("consistent",1e3,(function(e,a,t){return new C(!1,e,a,t)}),void 0,a),o=(0,n.useState)(!0),c=o[0],p=o[1],r=(0,n.useState)((function(){return{marginLeft:A(t.getCurrentValue(c)),time:t.clock.getCurrentTime()/1e3}})),m=r[0],k=m.marginLeft,N=m.time,l=r[1];return(0,n.useEffect)((function(){var e=window.setInterval((function(){l({time:t.clock.getCurrentTime()/1e3,marginLeft:A(t.getCurrentValue(c))})}),30);return function(){return window.clearInterval(e)}}),[t,c]),(0,j.jsxs)("div",{className:"d-flex flex-column m-3",children:[(0,j.jsxs)("div",{style:{border:"1px solid"},children:[(0,j.jsxs)("span",{children:["time: ",N.toFixed(0)]}),(0,j.jsx)("div",{style:{width:"3rem",height:"3rem",marginLeft:k,background:"#f00",borderRadius:"100%"}})]}),(0,j.jsx)("button",{className:"align-self-start mt-2 btn btn-outline-primary",onClick:function(){return t.invert()},children:"invert"}),(0,j.jsxs)("div",{className:"d-flex flex-row mt-2",children:[(0,j.jsx)("input",{checked:c,onChange:function(e){return p(e.target.checked)},className:"form-check-input me-2",type:"checkbox"}),(0,j.jsx)("label",{className:"form-check-label",children:"Smooting"})]})]})}function A(e){return"calc(".concat((100*e).toFixed(3),"% - ").concat((3*e).toFixed(3),"rem)")}},4604:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/consistent",function(){return t(1568)}])}},function(e){e.O(0,[667,561,100,774,888,179],(function(){return a=4604,e(e.s=a);var a}));var a=e.O();_N_E=a}]);